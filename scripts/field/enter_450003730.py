# id 450003730 (Lachelein Night Market : Noisy Market), field 450003730
sm.lockInGameUI(True, False)
sm.blind(True, 255, 0, 0, 0, 0)
sm.spawnNpc(3003258, 660, -50)
sm.showNpcSpecialActionByTemplateId(3003258, "summon", 0)
sm.spawnNpc(3003251, 460, -50)
sm.showNpcSpecialActionByTemplateId(3003251, "summon", 0)
sm.zoomCamera(0, 2000, 0, 650, 50)
sm.blind(True, 255, 0, 0, 0, 0)
sm.sendDelay(1200)
sm.blind(False, 0, 0, 0, 0, 1000)
sm.sendDelay(1400)
sm.setSpeakerType(3)
sm.setParam(37)
sm.setColor(1)
sm.setInnerOverrideSpeakerTemplateID(3003258) # Music Box
sm.sendNext("Ugh... I don't feel so--")
sm.showNpcSpecialActionByTemplateId(3003258, "remove", 0)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.sendDelay(2000)
sm.showNpcSpecialActionByTemplateId(3003258, "stand2", -1)
sm.setParam(57)
sm.sendNext("He turned into a music box?!")
sm.setParam(37)
sm.setInnerOverrideSpeakerTemplateID(3003251) # Protective Mask
sm.sendSay("#face0#It's just as I suspected. The music boxes are what's maintaining this \r\ndreamworld! ")
sm.sendDelay(1000)
sm.zoomCamera(450, 2000, 350, 180, 50)
sm.sendDelay(1000)
sm.flipNpcByTemplateId(3003251, True)
sm.forcedFlip(True)
sm.spawnNpc(3003257, 120, -50)
sm.showNpcSpecialActionByTemplateId(3003257, "summon", 0)
sm.showEffect("Effect/Summon.img/50", 0, 120, 70, 0, 0, 1, 0)
sm.playSound("summon/0", 100)
sm.sendDelay(200)
sm.spawnNpc(3003257, 60, -50)
sm.showNpcSpecialActionByTemplateId(3003257, "summon", 0)
sm.showEffect("Effect/Summon.img/50", 0, 60, 70, 0, 0, 1, 0)
sm.playSound("summon/0", 100)
sm.sendDelay(200)
sm.spawnNpc(3003257, 0, -50)
sm.showNpcSpecialActionByTemplateId(3003257, "summon", 0)
sm.showEffect("Effect/Summon.img/50", 0, 0, 70, 0, 0, 1, 0)
sm.playSound("summon/0", 100)
sm.sendDelay(200)
sm.sendDelay(700)
sm.setParam(45)
sm.setInnerOverrideSpeakerTemplateID(3003257) # Dreamkeeper
sm.sendNext("     The music box...  Hands off...")
sm.zoomCamera(500, 2000, 500, 650, 50)
sm.sendDelay(1000)
sm.moveNpcByTemplateId(3003251, True, 200, 160)
sm.setParam(37)
sm.setInnerOverrideSpeakerTemplateID(3003251) # Protective Mask
sm.sendNext("#face0#I'll buy you some time, destroy the music box! ")
sm.sendDelay(1000)
sm.zoomCamera(0, 2000, 0, 650, 50)
sm.forcedFlip(True)
sm.sendDelay(500)
sm.forcedAction(10, 0)
sm.playSound("Aran/swingT2", 100)
sm.sendDelay(100)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.sendDelay(500)
sm.forcedAction(10, 0)
sm.playSound("Aran/swingT2", 100)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.sendDelay(500)
sm.forcedAction(10, 0)
sm.playSound("Aran/swingT2", 100)
sm.sendDelay(100)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.sendDelay(500)
sm.forcedAction(10, 0)
sm.playSound("Aran/swingT2", 100)
sm.sendDelay(100)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.setParam(57)
sm.sendNext("(It's more durable than you expected...)")
sm.setParam(45)
sm.setInnerOverrideSpeakerTemplateID(3003257) # Dreamkeeper
sm.sendSay("     Move... You're in the way.")
sm.setParam(37)
sm.setInnerOverrideSpeakerTemplateID(3003251) # Protective Mask
sm.sendSay("#face0#Destroy the music box, #h0#! ")
sm.sendDelay(500)
sm.forcedAction(10, 0)
sm.playSound("Aran/swingT2", 100)
sm.sendDelay(100)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.sendDelay(500)
sm.forcedAction(10, 0)
sm.playSound("Aran/swingT2", 100)
sm.sendDelay(100)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.sendDelay(500)
sm.forcedAction(10, 0)
sm.playSound("Aran/swingT2", 100)
sm.sendDelay(100)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.sendDelay(500)
sm.forcedAction(10, 0)
sm.playSound("Aran/swingT2", 100)
sm.sendDelay(100)
sm.playSound("Sound/SoundEff.img/ArcaneRiver/regen", 200)
sm.sendDelay(500)
sm.showNpcSpecialActionByTemplateId(3003258, "die", -1)
sm.playSound("Sound/Mob.img/8643013/Die", 200)
sm.sendDelay(2000)
sm.setParam(57)
sm.sendNext("I did it!")
sm.showNpcSpecialActionByTemplateId(3003251, "sit", -1)
sm.zoomCamera(500, 2000, 500, 180, 50)
sm.sendDelay(1000)
sm.sendNext("Protective Mask!")
sm.setParam(45)
sm.setInnerOverrideSpeakerTemplateID(3003257) # Dreamkeeper
sm.sendSay("     We're too late... The music box... ")
sm.sendSay("     The dream is... fading...")
sm.playSound("Sound/Mob.img/8643000/Die", 200)
sm.showNpcSpecialActionByTemplateId(3003257, "die", -1)
sm.showNpcSpecialActionByTemplateId(3003257, "die", -1)
sm.showNpcSpecialActionByTemplateId(3003257, "die", -1)
sm.sendDelay(3000)
sm.completeQuest(34315)
sm.startQuest(34316)
sm.lockInGameUI(False, True)
sm.warp(450003330)
